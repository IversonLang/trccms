<!DOCTYPE html>
<html>

	<head>
		{(admin_meta.html)}
	</head>
		
<body>
		<div class="top">
			<div>
				<img src="/static/files/logo.png" />
				<a href="/auth/logout">
                    <span class="logout">退出登录</span>
                </a>
                
			</div>
		</div>

		<div class="container" data-pagename="{{pagename}}">
			<div class="nav">
				<span><a  href="/admin/ad">广告</a></span>
				<span><a  href="/admin/judo">柔道</a></span>
				<span><a  href="/admin/yoga">瑜伽</a></span>
				<span><a  href="/admin/freepower">自由力量</a></span>
				<span><a  href="/admin/aerabic">有氧运动</a></span>
			</div>

			<div class="discr roudao">
				<p class="title">封面广告图</p>
				<div class="showpic3" id="cover_image_list">
				    {%for _,v in pairs(covers) do %}
					   <div class="pic-box2" data-uuid = "{{v.cover_id}}" style="position:relative">
						   <img class="showing" src="{{v.cover_img}}" />
						   <img class="del" src="/static/files/del.png" style="position:absolute;right:10px;bottom:0px" onclick="DelImage(this)"/>
					   </div>
				    {%end%}
			    </div>
			   
				<div class ="wrapper">
        		  <div class ="uploader_container">
            		<div class= "uploader" id="cover_uploader">
                		<div class="queueList">
                    		<div id="cover_dndArea" class="placeholder">
                        		<div id="cover_filePicker" ></div>
                        		<p id="cover_uploader_count">或将照片拖到这里，封面照片最多可选4张</p>
                    		</div>
                		</div>
                		<div class="statusBar" style="display:none;">
                    		<div class="progress">
                        		<span class="text">0%</span>
                        		<span class="percentage"></span>
                    		</div>
                    		<div class="info"></div>
                    		<div class="btns">
                        		<div id="cover_filePicker2"></div><div class="uploadBtn">开始上传</div>
                    		</div>
                		</div>
            		</div>
            	  </div>
    		    </div>
    		   

			<!--柔道介绍-->
			<div class="discr roudao">
			   <p class="title">场馆介绍</p>

               <div class="showpic3" id="gymnasium_pic_list">
                    {%for _,v in pairs(gymnasiumPics) do %}
                       <div class="pic-box2" data-uuid = "{{v.gymnasium_pic_id}}" style="position:relative">
                           <img class="showing" src="{{v.gymnasium_pic}}" />
                           <img class="del" src="/static/files/del.png" style="position:absolute;right:10px;bottom:0px" onclick="del_g_pic(this)"/>
                       </div>
                    {%end%}
                </div>


			   <div class ="wrapper">
        		   <div class ="uploader_container">
            	<!--头部，相册选择和格式选择-->
            		  <div class= "uploader" id="gymnasium_uploader">
                		 <div class="queueList">
                    		<div id="gymnasium_dndArea" class="placeholder">
                        		<div id="gymnasium_filePicker" ></div>
                        		<p id="gymnasium_uploader_count">或将照片拖到这里，场地照片最多可选6张</p>
                    		</div>
                		 </div>
                		 <div class="statusBar" style="display:none;">
                    		<div class="progress">
                        		<span class="text">0%</span>
                        		<span class="percentage"></span>
                    		</div>
                    		<div class="info"></div>
                    		<div class="btns">
                        		<div id="gymnasium_filePicker2" ></div><div class="uploadBtn">开始上传</div>
                    		</div>
                		 </div>
            		 </div>
            	  </div>
    	 	   </div>


			   <div class="edit">
					<label>文章内容<span class="red">*</span></label>
					<div class="editBox" style="width:85%">
						<div id="groundEditor">
                        {%if #gymnasiumDescri > 0 then %}
                            {%for _,v in pairs(gymnasiumDescri) do %}
                                {*v.gymnasium_descri*}
                            {%end%}
                        {%else%}
                                <p>请输入文字内容</p>
                        {%end%}
							
						</div>
						
						<div class="saveBox">
							<span class="btn-new-ad" id="gymnasium_text">保存</span>
						</div>
					</div>
				</div>
    		</div>
				
			
			<!--教练介绍-->
			<div class="discr roudao">
				<p class="title">教练介绍</p>
				<div class="showpic3" id="trainner_image_list">
                    {%for _,v in pairs(TrainnerPics) do %}
                       <div class="pic-box2" data-uuid = "{{v.trainer_pic_id}}" style="position:relative">
                           <img class="showing" src="{{v.trainer_img}}" />
                           <img class="del" src="/static/files/del.png" style="position:absolute;right:10px;bottom:0px" onclick="DelTrainnerImage(this)"/>
                       </div>
                    {%end%}
                </div>
				<div class ="wrapper">
        		   <div class ="uploader_container">
            	<!--头部，相册选择和格式选择-->
            		  <div class= "uploader" id="trainner_uploader">
                		 <div class="queueList">
                    		<div id="trainner_dndArea" class="placeholder">
                        		<div id="trainner_filePicker" ></div>
                        		<p>或将照片拖到这里，教练照片最多可选1张</p>
                    		</div>
                		 </div>
                		 <div class="statusBar" style="display:none;">
                    		<div class="progress">
                        		<span class="text">0%</span>
                        		<span class="percentage"></span>
                    		</div>
                    		<div class="info"></div>
                    		<div class="btns">
                        		<div id="trainner_filePicker2" ></div><div class="uploadBtn">开始上传</div>
                    		</div>
                		 </div>
            		 </div>
            	  </div>
    	 	   </div>



				<div class="edit">
					<label>文章内容<span class="red">*</span></label>
					<div class="editBox" style="width:85%">
						<div id="trainnnerEditor">
						{%if #TrainnerDescr > 0 then %}
                            {%for _,v in pairs(TrainnerDescr) do %}
                                {*v.trainer_descri*}
                            {%end%}
                        {%else%}
                                <p>请输入文字内容</p>
                        {%end%}
						</div>
						
						<div class="saveBox">
							<span class="btn-new-ad" id= "trainner_text">保存</span>
						</div>
					</div>
				</div>

            </div>
				
			
			<!--课程表-->
			<div class="discr roudao" style="height: 270px;">
				<p class="title">课程表//</p>
				<div class="tableBox">
					<table style="margin-left: auto;margin-right: auto;">
						<tr>
							<th>时间</th>
							<th>星期一</th>
							<th>星期二</th>
							<th>星期三</th>
							<th>星期四</th>
							<th>星期五</th>
							<th>星期六</th>
							<th>星期天</th>
						</tr>
                        {%if #Courses > 0 then %}
                          {% for _,v in pairs(Courses) do %}
                            <tr>
                              <td><input type="text" name="mor_time"    value="{{v.mor_time}}"></td>
                              <td><input type="text" name="monday_mor"  value="{{v.monday_mor}}"></td>
                              <td><input type="text" name="tuesday_mor" value="{{v.tuesday_mor}}"></td>
                              <td><input type="text" name="wednesday_mor" value="{{v.wednesday_mor}}"></td>
                              <td><input type="text" name="thursday_mor"  value="{{v.thursday_mor}}"></td>
                              <td><input type="text" name="friday_mor"   value="{{v.friday_mor}}"></td>
                              <td><input type="text" name="saturday_mor" value="{{v.saturday_mor}}"></td>
                              <td><input type="text" name="sunday_mor"   value="{{v.sunday_mor}}"></td>
                            </tr>
                            <tr>
                              <td><input type="text" name="after_time" value="{{v.after_time}}"></td>
                              <td><input type="text" name="monday_after" value="{{v.monday_after}}"></td>
                              <td><input type="text" name="tuesday_after" value="{{v.tuesday_after}}"></td>
                              <td><input type="text" name="wednesday_after" value="{{v.wednesday_after}}"></td>
                              <td><input type="text" name="thursday_after" value="{{v.thursday_after}}"></td>
                              <td><input type="text" name="friday_after" value="{{v.friday_after}}"></td>
                              <td><input type="text" name="saturday_after" value="{{v.saturday_after}}"></td>
                            <td><input type="text" name="sunday_after" value="{{v.sunday_after}}"></td>
                           </tr>
                          {%end%}
                        {%else%}
						<tr>
							<td><input type="text" name="mor_time"></td>
							<td><input type="text" name="monday_mor"></td>
							<td><input type="text" name="tuesday_mor"></td>
							<td><input type="text" name="wednesday_mor"></td>
							<td><input type="text" name="thursday_mor"></td>
							<td><input type="text" name="friday_mor"></td>
							<td><input type="text" name="saturday_mor"></td>
							<td><input type="text" name="sunday_mor"></td>
						</tr>
						<tr>
							<td><input type="text" name="after_time"></td>
							<td><input type="text" name="monday_after"></td>
							<td><input type="text" name="tuesday_after"></td>
							<td><input type="text" name="wednesday_after"></td>
							<td><input type="text" name="thursday_after"></td>
							<td><input type="text" name="friday_after"></td>
							<td><input type="text" name="saturday_after"></td>
							<td><input type="text" name="sunday_after"></td>
						</tr>
                        {%end%}
					</table>
					
				</div>
				<div class="savepage" style="margin-left: auto;text-align:center;margin-right: auto;" >
						<span class="btn-new-ad" id="course_save">保存课表信息</span>
				</div>
			</div>
		</div>
		<!--end container-->
		
	</body>
		<!--end container-->
		
		<script type="text/javascript">
			 
		function createConentEdit(eidtor_name)
		{
			var editor = new wangEditor(eidtor_name);


			 editor.config.colors = {
        		'#880000': '暗红色',
        		'#800080': '紫色',
        		'#ff0000': '红色'
    		};

    		// 字体
   			editor.config.familys = [
        		'宋体', '黑体', '楷体', '微软雅黑',
        		'Arial', 'Verdana', 'Georgia'
    		];

    		// 字号
    		editor.config.fontsizes = {
        	// 格式：'value': 'title'
        		1: '10px',
        		2: '13px',
        		3: '16px',
        		4: '19px',
        		5: '22px',
        		6: '25px',
        		7: '28px'
    		};


    		editor.config.menus = [
        		'source',
        		'|',     // '|' 是菜单组的分割线
        		'bold',
        		'underline',
        		'italic',
        		'strikethrough',
        		'eraser',
        		'forecolor',
        		'bgcolor',
        		'|',
        		'quote',
        		'fontfamily',
        		'fontsize',
        		'head',
        		'unorderlist',
        		'orderlist',
        		'alignleft',
        		'aligncenter',
        		'alignright',
        		'|',
        		'link',
        		'unlink',
        		'table',
        		'|',
        		'undo',
        		'redo'
     			];


       	    // editor.config.hideLinkImg = true;

    		 editor.create();

             return editor;
		}
		var editorname = 'groundEditor';
		var editorname_two = 'trainnnerEditor';
		var editor1 = createConentEdit(editorname);
		var editor2 = createConentEdit(editorname_two);
        var api_descri_Url;
        var descri_id;
        var api_trainner_url;
        var trainner_descri_id;
        var course_api_url;
        var course_id;

        {%if #gymnasiumDescri > 0 then %}
            api_descri_Url = '/gymnasiumDescri/update';
            {%for _,v in pairs(gymnasiumDescri) do %}
                descri_id = {{v.gymnasium_id}};
            {%end%}
        {%else%}
            api_descri_Url = '/gymnasiumDescri/new';
        {%end%}

        {%if #TrainnerDescr > 0 then %}
            api_trainner_url = '/trainnerDescri/update';
            {%for _,v in pairs(TrainnerDescr) do %}
                trainner_descri_id= {{v.trainer_id}};
            {%end%}
        {%else%}
            api_trainner_url = '/trainnerDescri/new';
        {%end%}

        {%if #Courses > 0 then %}
            course_api_url = '/course/update';
            {% for _,v in pairs(Courses) do %}
                course_id = {{v.course_id}};
            {%end%}

        {%else%}
            course_api_url = '/course/new';
        {%end%}


		function delCoverImage(delObject,coverImageId){

			$.ajax({
				url:'/cover/delete',
                type:'post',
                async: true,
                data:{
                        id:coverImageId
                },
                dataType : 'json',
                success : function(result){
                	if(result.success)
                	{
            			delObject.parent('div').remove();
                		var imageCount = $(".pic-box2").length;
						if( imageCount == 4)
            			{
               				$("#cover_uploader").hide();
            			}
            			else
            			{
              				$("#cover_uploader").show();
              				var rest = 4 - imageCount;
              				$("#cover_uploader_count").text("或将照片拖到这里，封面照片最多可选"+rest+"张");
            			}
                	}
                	else
            		{
            			
            		}
                },
                error:function(){
                	
                }
			});
			
		}

        function delgymnasiumPics(delObject,coverImageId){

            $.ajax({
                url:'/gymnasiumPic/delete',
                type:'post',
                async: true,
                data:{
                        id:coverImageId
                },
                dataType : 'json',
                success : function(result){
                    if(result.success)
                    {
                        delObject.parent('div').remove();
                        var imageCount = $("#gymnasium_pic_list .pic-box2").length;
                        if( imageCount == 6)
                        {
                            $("#gymnasium_uploader").hide();
                        }
                        else
                        {
                            $("#gymnasium_uploader").show();
                            var rest = 6 - imageCount;
                            $("#gymnasium_uploader_count").text("或将照片拖到这里，封面照片最多可选"+rest+"张");
                        }
                    }
                    else
                    {
                        
                    }
                },
                error:function(){
                    
                }
            });
            
        }

		function DelImage(Obj){

			var coverImageId = $(Obj).parent('div').attr("data-uuid");
			var delObject = $(Obj);
			delCoverImage(delObject,coverImageId);
		}

		function del_g_pic(Obj){
            var coverImageId = $(Obj).parent('div').attr("data-uuid");
            var delObject = $(Obj);
            delgymnasiumPics(delObject,coverImageId);
        }

        function coverUploader(){
            var imageCount = $("#cover_image_list .pic-box2").length;
            
            if( imageCount == 4)
            {
               $("#cover_uploader").hide();
            }
            else
            {
              $("#cover_uploader").show();
              var rest = 4 - imageCount;
              $("#gymnasium_uploader_count").text("或将照片拖到这里，封面照片最多可选"+rest+"张");
            }
        }


        function gymnasiumUploader(){

            var imageCount = $("#gymnasium_pic_list .pic-box2").length;
            
            if( imageCount == 6)
            {
               $("#gymnasium_uploader").hide();
            }
            else
            {
              $("#gymnasium_uploader").show();
              var rest = 6 - imageCount;
              $("#gymnasium_uploader_count").text("或将照片拖到这里，封面照片最多可选"+rest+"张");
            }
        }

        function trainnerUploader(){

            var imageCount = $("#trainner_image_list .pic-box2").length;
            
            if( imageCount == 1)
            {
               $("#trainner_uploader").hide();
            }
            else
            {
              $("#trainner_uploader").show();
            }
        }


        function selectNav(){

            var title = document.title;

            $('.nav a').each(function(){

                var txt = $(this).text();
                if(title == txt)
                {
                    $(this).addClass("active")
                }
                else
                {
                    $(this).removeClass("active")
                }
            });
        }

        $('#gymnasium_text').on('click',function(){

                var content = editor1.$txt.html();

                if (content.length < 20) 
                {
                    alert("请补充完内容");
                    return;
                }
                
                if(content.length > 1000)
                {
                    alert("超过编辑最大字数");
                    return;
                }

            $.ajax({
                url: api_descri_Url,
                type:'post',
                async: true,
                {%if #gymnasiumDescri > 0 then %}      
                    data:{
                            id:descri_id,
                            descri: content,
                            pagename: $('.container').attr('data-pagename')
                    },
                {%else%}
                    data:{
                            descri: content,
                            pagename: $('.container').attr('data-pagename')
                    },      
                {%end%}
                dataType : 'json',
                success:function(result){
                    if(result.success)
                    {
                        alert("保存场馆成功");
                    }
                    else
                    {
                        alert("保存场馆介绍失败");
                    }
                    window.location.reload();
                },
                error:function(){
                     alert("保存场馆介绍出现异常，请检查网络");
                }


            });

        });
        

        function deltrainnerPic(delObject,ImageId){
            $.ajax({
                url:'/trainnerPic/delete',
                type:'post',
                async: true,
                data:{
                        id:ImageId
                },
                dataType : 'json',
                success : function(result){
                    if(result.success)
                    {
                        delObject.parent('div').remove();
                        var imageCount = $("#trainner_image_list .pic-box2").length;
                        if( imageCount == 1)
                        {
                            $("#trainner_uploader").hide();
                        }
                        else
                        {
                            $("#trainner_uploader").show();
                        }
                    }
                    else
                    {
                        
                    }
                },
                error:function(){
                    
                }
            });
        }
        

        function DelTrainnerImage(Obj){
            var ImageId = $(Obj).parent('div').attr("data-uuid");
            var delObject = $(Obj);
            deltrainnerPic(delObject,ImageId);

        }
        $('#trainner_text').on('click',function(){

                var content = editor2.$txt.html();

                if (content.length < 20) 
                {
                    alert("请补充完内容");
                    return;
                }
                
                if(content.length > 1000)
                {
                    alert("超过编辑最大字数");
                    return;
                }

            $.ajax({
                url: api_trainner_url,
                type:'post',
                async: true,
                {% if #TrainnerDescr > 0 then %}      
                    data:{
                            id:trainner_descri_id,
                            descri: content,
                            pagename: $('.container').attr('data-pagename')
                    },
                {%else%}
                    data:{
                            descri: content,
                            pagename: $('.container').attr('data-pagename')
                    },      
                {%end%}
                dataType : 'json',
                success:function(result){
                    if(result.success)
                    {
                        alert("保存教练介绍成功");
                    }
                    else
                    {
                        alert("保存场教练介绍绍失败");
                    }
                    window.location.reload();
                },
                error:function(){
                     alert("保存教练介绍出现异常，请检查网络");
                }


            });

        });
        
        


        $('#course_save').on('click',function(){
            $.ajax({
                url: course_api_url,
                type:'post',
                async: true,
                {%if #Courses > 0 then %}
                    data:{
                         id:course_id,
                         mor_time:$("input[name=mor_time]").val(),
                         after_time:$("input[name=after_time]").val(),
                         monday_mor:$("input[name=monday_mor]").val(),
                         monday_after:$("input[name=monday_after]").val(),
                         tuesday_mor:$("input[name=tuesday_mor]").val(),
                         tuesday_after:$("input[name=tuesday_after]").val(),
                         wednesday_mor:$("input[name=wednesday_mor]").val(),
                         wednesday_after:$("input[name=wednesday_after]").val(),
                         thursday_mor:$("input[name=thursday_mor]").val(),
                         thursday_after:$("input[name=thursday_after]").val(),
                         friday_mor:$("input[name=friday_mor]").val(),
                         friday_after:$("input[name=friday_after]").val(),
                         saturday_mor:$("input[name=saturday_mor]").val(),
                         saturday_after:$("input[name=saturday_after]").val(),
                         sunday_mor:$("input[name=sunday_mor]").val(),
                         sunday_after:$("input[name=sunday_after]").val()
                    },
                {%else%}
                     data:{
                         mor_time:$("input[name=mor_time]").val(),
                         after_time:$("input[name=after_time]").val(),
                         monday_mor:$("input[name=monday_mor]").val(),
                         monday_after:$("input[name=monday_after]").val(),
                         tuesday_mor:$("input[name=tuesday_mor]").val(),
                         tuesday_after:$("input[name=tuesday_after]").val(),
                         wednesday_mor:$("input[name=wednesday_mor]").val(),
                         wednesday_after:$("input[name=wednesday_after]").val(),
                         thursday_mor:$("input[name=thursday_mor]").val(),
                         thursday_after:$("input[name=thursday_after]").val(),
                         friday_mor:$("input[name=friday_mor]").val(),
                         friday_after:$("input[name=friday_after]").val(),
                         saturday_mor:$("input[name=saturday_mor]").val(),
                         saturday_after:$("input[name=saturday_after]").val(),
                         sunday_mor:$("input[name=sunday_mor]").val(),
                         sunday_after:$("input[name=sunday_after]").val(),
                         pagename: $('.container').attr('data-pagename')
                    },
                {%end%}
                dataType : 'json',
                success:function(result){
                    if(result.success)
                    {
                        alert("保存课程表成功");
                    }
                    else
                    {
                        alert("保存课程表失败");
                    }
                    window.location.reload();
                },
                error:function(){

                }
            });


        });

		$(document).ready(function(){ 
　　	　 		selectNav();
　　	　 		coverUploader();
　　	　      gymnasiumUploader();
            trainnerUploader();

		}); 




		</script>

</html>